{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var field \nystudio107\units\fields\Units #}
{#
/**
 * Units plugin for Craft CMS
 *
 * Units Field Settings
 *
 * @author    nystudio107
 * @copyright Copyright (c) 2018 nystudio107
 * @link      https://nystudio107.com/
 * @package   Units
 * @since     1.0.0
 */
#}

{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("nystudio107\\units\\assetbundles\\units\\UnitsAsset") %}
{% do view.registerAssetBundle("nystudio107\\units\\assetbundles\\unitsfield\\UnitsFieldAsset") %}

{{ forms.selectField({
    label: "Measure Type"|t("units"),
    id: "defaultUnitsClass",
    name: "defaultUnitsClass",
    options: unitsClassMap,
    value: field.defaultUnitsClass,
    errors: field.getErrors("defaultUnitsClass"),
}) }}

{{ forms.selectField({
    label: "Default Units"|t("units"),
    id: "defaultUnits",
    name: "defaultUnits",
    options: craft.units.availableUnits(field.defaultUnitsClass),
    value: field.defaultUnits,
    errors: field.getErrors("defaultUnits"),
}) }}

{{ forms.lightswitchField({
    label: "Units Changeable"|t("units"),
    id: "changeableUnits",
    name: "changeableUnits",
    on: field.changeableUnits,
    errors: field.getErrors("changeableUnits"),
}) }}

{% js %}
    // Fill in the dynamic unit menu
    var defaultUnitsId = '{{ "defaultUnits" |namespaceInputId }}';
    var defaultUnitsClassId = '{{ "defaultUnitsClass" |namespaceInputId }}';

    $('#'+defaultUnitsClassId).on('change', function(e) {
        var value = $('#'+defaultUnitsClassId).val();
        fillDynamicUnitsMenu(defaultUnitsId, '{{ field.defaultUnits }}', value);
    });
{% endjs %}
