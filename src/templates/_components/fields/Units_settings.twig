{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var field \nystudio107\units\fields\Units #}
{#
/**
 * Units plugin for Craft CMS
 *
 * Units Field Settings
 *
 * @author    nystudio107
 * @copyright Copyright (c) 2018 nystudio107
 * @link      https://nystudio107.com/
 * @package   Units
 * @since     1.0.0
 */
#}

{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("nystudio107\\units\\assetbundles\\units\\UnitsAsset") %}
{% do view.registerAssetBundle("nystudio107\\units\\assetbundles\\unitsfield\\UnitsFieldAsset") %}

{{ forms.selectField({
    label: "Measure Type"|t("units"),
    id: "unitsClass",
    name: "unitsClass",
    options: unitsClassMap,
    value: field.unitsClass,
    errors: field.getErrors("unitsClass"),
}) }}

{{ forms.selectField({
    label: "Default Units"|t("units"),
    id: "defaultUnits",
    name: "defaultUnits",
    options: field.getAvailableUnits(),
    value: field.defaultUnits,
    errors: field.getErrors("defaultUnits"),
}) }}

{{ forms.checkboxSelectField({
    label: "Allowed Units"|t("units"),
    id: "allowedUnits",
    name: "allowedUnits",
    showAllOption: true,
    options: field.getAvailableUnits(),
    errors: field.getErrors("allowedUnits"),
    values: field.allowedUnits ?? '*',
}) }}

{{ forms.lightswitchField({
    label: "Allow Units to Be Changed?"|t("units"),
    id: "changeableUnits",
    name: "changeableUnits",
    on: field.changeableUnits,
    errors: field.getErrors("changeableUnits"),
}) }}

{% js %}
    // Fill in the dynamic unit menu
    var $defaultUnits = $('#{{ "defaultUnits"|namespaceInputId }}');
    var $allowedUnits = $('#{{ "allowedUnits"|namespaceInputId }}');
    var $unitsClass = $('#{{ "unitsClass"|namespaceInputId }}');

    $unitsClass.on('change', function(event) {
        fillUnits($defaultUnits.add($allowedUnits), event.target.value);
    });
{% endjs %}
